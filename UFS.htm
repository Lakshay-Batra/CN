<html>

<head>
<meta name="GENERATOR" content="Microsoft FrontPage 5.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<title>MAIN</title>
<style>
<!--
 table.MsoNormalTable
	{mso-style-parent:"";
	font-size:10.0pt;
	font-family:"Times New Roman"}
span.mw-headline
	{}
 li.MsoNormal
	{mso-style-parent:"";
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:"Times New Roman";
	margin-left:0in; margin-right:0in; margin-top:0in}
h2
	{margin-right:0in;
	margin-left:0in;
	font-size:18.0pt;
	font-family:"Times New Roman";
	font-weight:bold}
-->
</style>
</head>

<body>

<p>&nbsp;</p>
<p align="center"><b><u>
  <font face="Arial" size="4" color="blue"><a href="Main.htm">M<font size=4 color="blue">AIN</font></a></font></u></b></p>
<p align="center">
<span style="text-transform: uppercase"><font size="6" color="#FF0000">
<span style="font-family: Arial; font-weight: 700; text-decoration:underline">FILE SYSTEM (UFS)</span></font></span></p>
<p class="MsoNormal" align="justify"><font face="Arial">&nbsp;&nbsp;<span lang="EN">The <b>
Unix file system</b> (<b>UFS</b>) is a file system used by many Unix and 
Unix-like operating systems. It is also called the <b>Berkeley Fast File System</b>, 
the <b>BSD Fast File System</b> or <b>FFS</b>. It is a distant descendant of the 
original filesystem used by Version 7 Unix.</span></font></p>
<p class="MsoNormal" align="justify"><font face="Arial">&nbsp;</font></p>
<table class="MsoNormalTable" border="1" cellspacing="5" cellpadding="0" width="352" style="width: 264.0pt; border: 1.0pt solid #AAAAAA; margin-left: 12.0pt; background: #F9F9F9">
  <tr>
    <td colspan="2" style="border: medium none; padding: 2.4pt">
    <p class="MsoNormal" align="center" style="text-align: justify; line-height: 18.0pt; margin: 6.0pt 0in">
    <font face="Arial"><b><span style="font-size: 13.0pt; color: black">UFS</span></b></font></td>
  </tr>
  <tr>
    <td valign="top" style="border: medium none; padding: 2.4pt">
    <p class="MsoNormal" style="line-height: 18.0pt; margin: 6.0pt 0in" align="justify">
    <font face="Arial"><b><span style="font-size: 10.5pt; color: black">
    Developer</span></b></font></td>
    <td valign="top" style="border: medium none; padding: 2.4pt">
    <p class="MsoNormal" style="line-height: 18.0pt; margin: 6.0pt 0in" align="justify">
    <font face="Arial"><span style="font-size: 10.5pt; color: black">CSRG</span></font></td>
  </tr>
  <tr>
    <td valign="top" style="border: medium none; padding: 2.4pt">
    <p class="MsoNormal" style="line-height: 18.0pt; margin: 6.0pt 0in" align="justify">
    <font face="Arial"><b><span style="font-size: 10.5pt; color: black">Full 
    name</span></b></font></td>
    <td valign="top" style="border: medium none; padding: 2.4pt">
    <p class="MsoNormal" style="line-height: 18.0pt; margin: 6.0pt 0in" align="justify">
    <font face="Arial"><span style="font-size: 10.5pt; color: black">UNIX file 
    system</span></font></td>
  </tr>
  <tr>
    <td valign="top" style="border: medium none; padding: 2.4pt">
    <p class="MsoNormal" style="line-height: 18.0pt; margin: 6.0pt 0in" align="justify">
    <font face="Arial"><b><span style="font-size: 10.5pt; color: black">
    Introduced</span></b></font></td>
    <td valign="top" style="border: medium none; padding: 2.4pt">
    <p class="MsoNormal" style="line-height: 18.0pt" align="justify">
    <font face="Arial"><span style="font-size: 10.5pt; color: black">(<span style="border: 1.0pt solid #AAAAAA; padding: 2.0pt; background: #F9F9F9">4.2BSD</span>)</span></font></td>
  </tr>
  <tr>
    <td colspan="2" valign="top" style="border: medium none; padding: 2.4pt">
    <p class="MsoNormal" align="center" style="text-align: justify; line-height: 18.0pt">
    <font face="Arial"><b><span style="font-size: 10.5pt; color: black">
    Structures</span></b></font></td>
  </tr>
  <tr>
    <td valign="top" style="border: medium none; padding: 2.4pt">
    <p class="MsoNormal" style="line-height: 18.0pt" align="justify">
    <font face="Arial"><b><span style="font-size: 10.5pt; color: black">
    Directory contents</span></b></font></td>
    <td valign="top" style="border: medium none; padding: 2.4pt">
    <p class="MsoNormal" style="line-height: 18.0pt" align="justify">
    <font face="Arial"><span style="font-size: 10.5pt; color: black">table</span></font></td>
  </tr>
  <tr>
    <td colspan="2" valign="top" style="border: medium none; padding: 2.4pt">
    <p class="MsoNormal" align="center" style="text-align: justify; line-height: 18.0pt">
    <font face="Arial"><b><span style="font-size: 10.5pt; color: black">Limits</span></b></font></td>
  </tr>
  <tr>
    <td valign="top" style="border: medium none; padding: 2.4pt">
    <p class="MsoNormal" style="line-height: 18.0pt" align="justify">
    <font face="Arial"><b><span style="font-size: 10.5pt; color: black">Max file 
    size</span></b></font></td>
    <td valign="top" style="border: medium none; padding: 2.4pt">
    <p class="MsoNormal" style="line-height: 18.0pt" align="justify">
    <font face="Arial"><span style="font-size: 10.5pt; color: black">2^73 bytes 
    (8 ZiB)</span></font></td>
  </tr>
  <tr>
    <td valign="top" style="border: medium none; padding: 2.4pt">
    <p class="MsoNormal" style="line-height: 18.0pt" align="justify">
    <font face="Arial"><b><span style="font-size: 10.5pt; color: black">Max 
    filename length</span></b></font></td>
    <td valign="top" style="border: medium none; padding: 2.4pt">
    <p class="MsoNormal" style="line-height: 18.0pt" align="justify">
    <font face="Arial"><span style="font-size: 10.5pt; color: black">255 bytes</span></font></td>
  </tr>
  <tr>
    <td valign="top" style="border: medium none; padding: 2.4pt">
    <p class="MsoNormal" style="line-height: 18.0pt" align="justify">
    <font face="Arial"><b><span style="font-size: 10.5pt; color: black">Max 
    volume size</span></b></font></td>
    <td valign="top" style="border: medium none; padding: 2.4pt">
    <p class="MsoNormal" style="line-height: 18.0pt" align="justify">
    <font face="Arial"><span style="font-size: 10.5pt; color: black">2^73 bytes 
    (8 ZiB)</span></font></td>
  </tr>
  <tr>
    <td colspan="2" valign="top" style="border: medium none; padding: 2.4pt">
    <p class="MsoNormal" align="center" style="text-align: justify; line-height: 18.0pt">
    <font face="Arial"><b><span style="font-size: 10.5pt; color: black">Features</span></b></font></td>
  </tr>
  <tr>
    <td valign="top" style="border: medium none; padding: 2.4pt">
    <p class="MsoNormal" style="line-height: 18.0pt" align="justify">
    <font face="Arial"><b><span style="font-size: 10.5pt; color: black">
    Supported operating systems</span></b></font></td>
    <td valign="top" style="border: medium none; padding: 2.4pt">
    <p class="MsoNormal" style="line-height: 18.0pt" align="justify">
    <font face="Arial"><span style="font-size: 10.5pt; color: black">FreeBSD, 
    OpenBSD, NetBSD,
    <span style="border: 1.0pt solid #AAAAAA; padding: 2.0pt; background: #F9F9F9">
    DragonFlyBSD</span>, A/UX and others</span></font></td>
  </tr>
</table>
<p class="MsoNormal" align="justify"><font face="Arial">&nbsp;</font></p>
<p class="MsoNormal" align="justify"><b><font face="Arial">
<span class="mw-headline"><span lang="EN">Design</span></span></font></b></p>
<p align="justify"><font face="Arial"><span lang="EN">A UFS volume is composed 
of the following parts:</span></font></p>
<ul type="disc" style="margin-bottom: 0in">
  <li class="MsoNormal">
  <p align="justify"><font face="Arial"><span lang="EN">a few blocks at the 
  beginning of the partition reserved for boot blocks (which must be initialized 
  separately from the filesystem)</span></font></li>
  <li class="MsoNormal">
  <p align="justify"><font face="Arial"><span lang="EN">a superblock, containing 
  a magic number identifying this as a UFS filesystem, and some other vital 
  numbers describing this filesystem's geometry and statistics and behavioral 
  tuning parameters</span></font></li>
  <li class="MsoNormal">
  <p align="justify"><font face="Arial"><span lang="EN">a collection of cylinder 
  groups. Each cylinder group has the following components: </span></font>
  <ul type="circle" style="margin-bottom: 0in">
    <li class="MsoNormal">
    <p align="justify"><font face="Arial"><span lang="EN">a backup copy of the 
    superblock</span></font></li>
    <li class="MsoNormal">
    <p align="justify"><font face="Arial"><span lang="EN">a cylinder group 
    header, with statistics, free lists, etc, about this cylinder group, similar 
    to those in the superblock</span></font></li>
    <li class="MsoNormal">
    <p align="justify"><font face="Arial"><span lang="EN">a number of inodes, 
    each containing file attributes</span></font></li>
    <li class="MsoNormal">
    <p align="justify"><font face="Arial"><span lang="EN">a number of data 
    blocks</span></font></li>
  </ul>
  </li>
</ul>
<p align="justify"><font face="Arial"><span lang="EN">Inodes are numbered 
sequentially. The first several inodes are reserved for historical reasons, 
followed by the inode for the root directory.</span></font></p>
<p align="justify"><font face="Arial"><span lang="EN">Directory files contain 
only the list of filenames in the directory and the inode associated with each 
file. All file metadata is kept in the inode.</span></font></p>
<h2 align="justify"><font face="Arial"><span class="mw-headline">
<span lang="EN">History and evolution</span></span></font></h2>
<p align="justify"><font face="Arial"><span lang="EN">Early versions of Unix 
filesystems were referred to simply as <i>FS</i>. FS only included the boot 
block, superblock, a clump of inodes, and the data blocks. This worked well for 
the small disks early Unixes were designed for, but as technology advanced and 
disks got larger, moving the head back and forth between the clump of inodes and 
the data blocks they referred to caused thrashing. BSD optimized this in FFS 
(Fast File System) by inventing cylinder groups. This breaks the disk up into 
smaller chunks, each with its own inode clump and data blocks.</span></font></p>
<p align="justify"><font face="Arial"><span lang="EN">The intent of BSD FFS is 
to try to localize associated data blocks and metadata in the same cylinder 
group; and, ideally, all of the contents of a directory (both data and metadata 
for all the files) in the same or nearby cylinder group, thus reducing 
fragmentation caused by scattering a directory's contents over a whole disk.</span></font></p>
<p align="justify"><font face="Arial"><span lang="EN">Some of the performance 
parameters in the superblock included number of tracks and sectors, disk 
rotation speed, head speed, and alignment of the sectors between tracks. In a 
fully optimized system, the head could be moved between close tracks to read 
scattered sectors from alternating tracks while waiting for the platter to spin 
around.</span></font></p>
<p align="justify"><font face="Arial"><span lang="EN">As disks grew larger and 
larger, sector level optimization became obsolete (especially with disks that 
used linear sector numbering and variable sectors per track). With larger disks 
and larger files, fragmented reads became more of a problem. To combat this, BSD 
originally increased the filesystem block size from one sector to 1k in 4.0BSD; 
and, in FFS, increased the filesystem block size from 1k to 8k. This has several 
effects. The chances of a file's sectors being contiguous is much greater. The 
amount of overhead to list the file's blocks is reduced. The number of blocks 
representable in a fixed bit width block number is increased (allowing for 
larger disks).</span></font></p>
<p align="justify"><font face="Arial"><span lang="EN">With larger block sizes, 
disks with many small files would waste a lot of space, so BSD added <i>block 
level fragmentation</i> (also called block suballocation, tail merging or tail 
packing), where the last partial block of data from several files may be stored 
in a single &quot;fragment&quot; block instead of multiple mostly empty blocks (Allen 
2005).</span></font></p>
<h2 align="justify"><font face="Arial"><span class="mw-headline">
<span lang="EN">Implementations</span></span></font></h2>
<p align="justify"><font face="Arial"><span lang="EN">Vendors of some commercial 
Unix systems, such as SunOS/Solaris, System V Release 4, HP-UX, and Tru64 UNIX, 
have adopted UFS. Most of them adapted UFS to their own uses, adding proprietary 
extensions that may not be recognized by other vendors' versions of Unix. 
Surprisingly, many have continued to use the original block size and data field 
widths as the original UFS, so some degree of (read) compatibility remains 
across platforms. Compatibility between implementations as a whole is spotty at 
best and should be researched before using it across multiple platforms where 
shared data is a primary intent.</span></font></p>
<p class="MsoNormal" align="justify"><font face="Arial"><span lang="EN">As of 
Solaris 7, Sun Microsystems included UFS Logging, which brought filesystem 
journaling to UFS. Solaris UFS also has extensions for large files and large 
disks and other features.</span></font></p>
<p class="MsoNormal" align="justify"><font face="Arial"><span lang="EN">&nbsp;In 
4.4BSD and BSD Unix systems derived from it, such as FreeBSD, NetBSD, OpenBSD, 
and DragonFlyBSD, the implementation of UFS1 and UFS2 is split into two layers — 
an upper layer that provides the directory structure and supports metadata 
(permissions, ownership, etc.) in the inode structure, and lower layers that 
provide data containers implemented as inodes. This was done to support both the 
traditional FFS and the LFS log-structured file system with shared code for 
common functions. The upper layer is called &quot;UFS&quot;, and the lower layers are 
called &quot;FFS&quot; and &quot;LFS&quot;. In some of those systems, the term &quot;FFS&quot; is used for the 
combination of the FFS lower layer and the UFS upper layer, and the term &quot;LFS&quot; 
is used for the combination of the LFS lower layer and the UFS upper layer.</span></font></p>
<p class="MsoNormal" align="justify"><font face="Arial"><span lang="EN">&nbsp;Kirk 
McKusick and Poul-Henning Kamp extended the FreeBSD FFS and UFS layers to 
support a new variant, called UFS2, which adds 64-bit block pointers (allowing 
volumes to grow up to 8 zettabytes), variable-sized blocks (similar to extents), 
extended flag fields, additional 'birthtime' stamps, extended attribute support 
and POSIX1.e ACLs. UFS2 became the default UFS version starting with FreeBSD 
5.0. FreeBSD also introduced soft updates and the ability to make file system 
snapshots for both UFS1 and UFS2. These have since been ported to NetBSD, but 
soft updates (called soft dependencies in NetBSD) will be removed from NetBSD 
6.0 in favor of the less complex file system journaling mechanism called WAPBL 
(also referred as logging), which was added to FFS in NetBSD 5.0. OpenBSD has 
supported soft updates since version 2.9 and limited UFS2 support (no ACLs and 
probably other changes) since version 4.2. Since FreeBSD 7.0, UFS also supports 
filesystem journaling using the gjournal GEOM provider.</span></font></p>
<p class="MsoNormal" align="justify"><font face="Arial"><span lang="EN">&nbsp;Linux 
includes a UFS implementation for binary compatibility at the read level with 
other Unixes, but since there is no standard implementation for the vendor 
extensions to UFS, Linux does not have full support for writing to UFS. The 
native Linux ext2 filesystem is inspired by UFS. (In fact, in some 
4.4BSD-derived systems, the UFS layer can use an ext2 layer as a container 
layer, just as it can use FFS and LFS.)</span></font></p>
<p class="MsoNormal" align="justify"><font face="Arial"><span lang="EN">NeXTStep, 
which was BSD-derived, also used a version of UFS. In Apple's Mac OS X, it is 
available as an alternative to HFS+, their proprietary filesystem. However, as 
of Mac OS X v10.5, one cannot install Mac OS X &quot;Leopard&quot; on a UFS-formatted 
volume. In addition, one cannot upgrade older versions of Mac OS X installed on 
UFS-formatted volumes to Leopard; upgrading requires reformatting the startup 
volume.[1] Currently there is a 4GB file limit for disks formated as UFS in Mac 
OSX.</span></font></p>
<p class="MsoNormal" align="justify"><font face="Arial"><span lang="EN">&nbsp;The 
PlayStation 3 game console uses UFS2 on HDD. The PlayStation 2 HDD used UFS as 
well.</span></font></p>
<p align="center"><b><u>
  <font face="Arial" size="4" color="blue"><a href="Main.htm">M<font size=4 color="blue">AIN</font></a></p>

</body>

</html>
